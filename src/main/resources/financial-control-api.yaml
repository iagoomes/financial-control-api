openapi: 3.0.3
info:
  title: Controle Financeiro API
  description: API para an√°lise de extratos banc√°rios e controle financeiro pessoal
  version: 1.0.0
tags:
  - name: Extracts
    description: Opera√ß√µes relacionadas ao processamento de extratos
  - name: Transactions
    description: Opera√ß√µes relacionadas √†s transa√ß√µes
  - name: Categories
    description: Opera√ß√µes relacionadas √†s categorias
  - name: Reports
    description: Relat√≥rios e an√°lises financeiras
paths:
  /extracts/upload:
    post:
      tags:
        - Extracts
      summary: Upload e processa extrato banc√°rio
      description: Recebe um arquivo PDF ou CSV do extrato e retorna as transa√ß√µes processadas
      operationId: uploadExtract
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Arquivo do extrato (PDF ou CSV)
                bank:
                  type: string
                  enum: [NUBANK, ITAU, BRADESCO, SANTANDER, CAIXA, BB]
                  description: Banco emissor do extrato
                  example: NUBANK
                month:
                  type: integer
                  minimum: 1
                  maximum: 12
                  description: M√™s de refer√™ncia do extrato
                  example: 7
                year:
                  type: integer
                  minimum: 2020
                  maximum: 2030
                  description: Ano de refer√™ncia do extrato
                  example: 2025
      responses:
        '200':
          description: Extrato processado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractAnalysisResponse'
        '400':
          description: Arquivo inv√°lido ou par√¢metros incorretos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /extracts/{extractId}:
    get:
      tags:
        - Extracts
      summary: Busca an√°lise de extrato por ID
      operationId: getExtractById
      parameters:
        - name: extractId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: ID √∫nico do extrato processado
      responses:
        '200':
          description: An√°lise do extrato encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExtractAnalysisResponse'
        '404':
          description: Extrato n√£o encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /extracts:
    get:
      tags:
        - Extracts
      summary: Lista todos os extratos processados
      operationId: listExtracts
      parameters:
        - name: bank
          in: query
          schema:
            type: string
            enum: [NUBANK, ITAU, BRADESCO, SANTANDER, CAIXA, BB]
          description: Filtrar por banco
        - name: year
          in: query
          schema:
            type: integer
          description: Filtrar por ano
        - name: month
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 12
          description: Filtrar por m√™s
      responses:
        '200':
          description: Lista de extratos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExtractSummary'

  /transactions/{transactionId}/categorize:
    patch:
      tags:
        - Transactions
      summary: Atualiza categoria de uma transa√ß√£o
      operationId: categorizeTransaction
      parameters:
        - name: transactionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategoryUpdateRequest'
      responses:
        '200':
          description: Categoria atualizada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionDTO'
        '404':
          description: Transa√ß√£o n√£o encontrada

  /categories:
    get:
      tags:
        - Categories
      summary: Lista todas as categorias dispon√≠veis
      operationId: listCategories
      responses:
        '200':
          description: Lista de categorias
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategoryDTO'

  /reports/monthly:
    get:
      tags:
        - Reports
      summary: Relat√≥rio mensal de gastos
      operationId: getMonthlyReport
      parameters:
        - name: year
          in: query
          required: true
          schema:
            type: integer
        - name: month
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
            maximum: 12
      responses:
        '200':
          description: Relat√≥rio mensal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthlyReport'

components:
  schemas:
    ExtractAnalysisResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: ID √∫nico do extrato processado
        bank:
          type: string
          enum: [NUBANK, ITAU, BRADESCO, SANTANDER, CAIXA, BB]
        period:
          $ref: '#/components/schemas/Period'
        summary:
          $ref: '#/components/schemas/FinancialSummary'
        transactions:
          type: array
          items:
            $ref: '#/components/schemas/TransactionDTO'
        categoryBreakdown:
          type: array
          items:
            $ref: '#/components/schemas/CategorySummary'
        processedAt:
          type: string
          format: date-time
      required:
        - id
        - bank
        - period
        - summary
        - transactions
        - categoryBreakdown
        - processedAt

    TransactionDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
        date:
          type: string
          format: date
          description: Data da transa√ß√£o
          example: "2025-07-30"
        title:
          type: string
          description: Descri√ß√£o/estabelecimento da transa√ß√£o
          example: "Mercantil Red"
        amount:
          type: number
          format: double
          description: Valor da transa√ß√£o (positivo para gastos, negativo para entradas)
          example: 30.71
        category:
          $ref: '#/components/schemas/CategoryDTO'
        originalDescription:
          type: string
          description: Descri√ß√£o original do extrato
        confidence:
          type: number
          format: double
          minimum: 0
          maximum: 1
          description: Confian√ßa na categoriza√ß√£o autom√°tica
      required:
        - id
        - date
        - title
        - amount
        - Category

    CategoryDTO:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Alimenta√ß√£o"
        color:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
          example: "#FF6B6B"
        icon:
          type: string
          example: "üçΩÔ∏è"
        parentCategoryId:
          type: string
          format: uuid
          nullable: true
      required:
        - id
        - name
        - color

    FinancialSummary:
      type: object
      properties:
        totalIncome:
          type: number
          format: double
          description: Total de entradas no per√≠odo
          example: 148.74
        totalExpenses:
          type: number
          format: double
          description: Total de gastos no per√≠odo
          example: 2340.50
        netAmount:
          type: number
          format: double
          description: Saldo l√≠quido (entradas - gastos)
          example: -2191.76
        transactionCount:
          type: integer
          description: N√∫mero total de transa√ß√µes
          example: 26
        averageTransactionValue:
          type: number
          format: double
          description: Valor m√©dio das transa√ß√µes
      required:
        - totalIncome
        - totalExpenses
        - netAmount
        - transactionCount

    CategorySummary:
      type: object
      properties:
        category:
          $ref: '#/components/schemas/CategoryDTO'
        totalAmount:
          type: number
          format: double
          description: Total gasto na categoria
        transactionCount:
          type: integer
          description: N√∫mero de transa√ß√µes na categoria
        percentage:
          type: number
          format: double
          description: Percentual do total de gastos
          minimum: 0
          maximum: 100
        averageAmount:
          type: number
          format: double
          description: Valor m√©dio por transa√ß√£o na categoria
      required:
        - category
        - totalAmount
        - transactionCount
        - percentage

    Period:
      type: object
      properties:
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 7
        year:
          type: integer
          example: 2025
        startDate:
          type: string
          format: date
          example: "2025-07-01"
        endDate:
          type: string
          format: date
          example: "2025-07-31"
      required:
        - month
        - year
        - startDate
        - endDate

    ExtractSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        bank:
          type: string
          enum: [NUBANK, ITAU, BRADESCO, SANTANDER, CAIXA, BB]
        period:
          $ref: '#/components/schemas/Period'
        totalExpenses:
          type: number
          format: double
        totalIncome:
          type: number
          format: double
        transactionCount:
          type: integer
        processedAt:
          type: string
          format: date-time
      required:
        - id
        - bank
        - period
        - totalExpenses
        - totalIncome
        - transactionCount
        - processedAt

    CategoryUpdateRequest:
      type: object
      properties:
        categoryId:
          type: string
          format: uuid
          description: ID da nova categoria
      required:
        - categoryId

    MonthlyReport:
      type: object
      properties:
        period:
          $ref: '#/components/schemas/Period'
        summary:
          $ref: '#/components/schemas/FinancialSummary'
        categoryBreakdown:
          type: array
          items:
            $ref: '#/components/schemas/CategorySummary'
        dailyExpenses:
          type: array
          items:
            $ref: '#/components/schemas/DailyExpense'
        topExpenses:
          type: array
          items:
            $ref: '#/components/schemas/TransactionDTO'
          maxItems: 10

    DailyExpense:
      type: object
      properties:
        date:
          type: string
          format: date
        totalAmount:
          type: number
          format: double
        transactionCount:
          type: integer
      required:
        - date
        - totalAmount
        - transactionCount

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: C√≥digo do erro
        message:
          type: string
          description: Mensagem descritiva do erro
        details:
          type: array
          items:
            type: string
          description: Detalhes adicionais do erro
        timestamp:
          type: string
          format: date-time
      required:
        - error
        - message
        - timestamp

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
